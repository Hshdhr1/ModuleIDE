<!-- xposed-hooking.html -->
<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Xposed Hooking ¬∑ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <nav class="toc">
    <h2>–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ</h2>
    <ul>
      <li><a href="#intro">–í–≤–µ–¥–µ–Ω–∏–µ</a></li>
      <li><a href="#concepts">–û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏</a></li>
      <li><a href="#handler-classes">–ë–∞–∑–æ–≤—ã–µ –∫–ª–∞—Å—Å—ã –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤</a></li>
      <li><a href="#param-object">–û–±—ä–µ–∫—Ç <code>param</code></a></li>
      <li><a href="#process">–ü—Ä–æ—Ü–µ—Å—Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è (—à–∞–≥ –∑–∞ —à–∞–≥–æ–º)</a></li>
      <li><a href="#examples">–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–∏–º–µ—Ä—ã</a></li>
    </ul>
  </nav>

  <main>
    <h1 id="intro">–í–≤–µ–¥–µ–Ω–∏–µ</h1>
    <p>
      Xposed‚Äë—Ö—É–∫–∏ –ø–æ–∑–≤–æ–ª—è—é—Ç –≤–∞—à–µ–º—É –ø–ª–∞–≥–∏–Ω—É –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞—Ç—å –≤—ã–∑–æ–≤—ã –º–µ—Ç–æ–¥–æ–≤ –∏–ª–∏ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–æ–≤ –≤–Ω—É—Ç—Ä–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, –º–µ–Ω—è—Ç—å –∏—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä—ã, –ø–æ–≤–µ–¥–µ–Ω–∏–µ –∏–ª–∏ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–º–µ–Ω—è—Ç—å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é ‚Äî –º–æ—â–Ω—ã–π —Å–ø–æ—Å–æ–± –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–∏ –Ω–∞ –Ω–∏–∑–∫–æ–º —É—Ä–æ–≤–Ω–µ.
    </p>

    <h1 id="concepts">–û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏</h1>
    <p>–î–ª—è –∫–∞–∂–¥–æ–≥–æ –º–µ—Ç–æ–¥–∞ —Å–æ–∑–¥–∞—ë—Ç—Å—è "hook handler" ‚Äî –∫–ª–∞—Å—Å –Ω–∞ Python, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å –∫–æ–¥ –¥–æ, –ø–æ—Å–ª–µ –∏–ª–∏ –≤–º–µ—Å—Ç–æ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–≥–æ –≤—ã–∑–æ–≤–∞ –º–µ—Ç–æ–¥–∞.</p>

    <h2 id="handler-classes">–ë–∞–∑–æ–≤—ã–µ –∫–ª–∞—Å—Å—ã –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤</h2>
    <ul>
      <li><code>MethodHook</code> ‚Äì –∑–∞–ø—É—Å–∫ –¥–æ/–ø–æ—Å–ª–µ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–≥–æ –º–µ—Ç–æ–¥–∞, –æ—Å—Ç–∞–≤–ª—è—è –µ–≥–æ –≤—ã–∑–≤–∞–Ω–Ω—ã–º.</li>
      <li><code>MethodReplacement</code> ‚Äì –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–º–µ–Ω—è–µ—Ç –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π –º–µ—Ç–æ–¥.</li>
    </ul>

    <h2 id="param-object">–û–±—ä–µ–∫—Ç <code>param</code></h2>
    <p>–ü–∞—Ä–∞–º–µ—Ç—Ä <code>param</code> (XC_MethodHook.Param) —Å–æ–¥–µ—Ä–∂–∏—Ç:</p>
    <ul>
      <li><code>param.thisObject</code> ‚Äî —ç–∫–∑–µ–º–ø–ª—è—Ä (None –¥–ª—è static).</li>
      <li><code>param.args</code> ‚Äî —Å–ø–∏—Å–æ–∫ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤, –º–æ–∂–Ω–æ —á–∏—Ç–∞—Ç—å –∏ –º–µ–Ω—è—Ç—å –ø–µ—Ä–µ–¥ –º–µ—Ç–æ–¥–æ–º.</li>
      <li><code>param.result</code> ‚Äî –≤–æ–∑–≤—Ä–∞—â—ë–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ, –¥–æ—Å—Ç—É–ø–Ω–æ –ø–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è.</li>
      <li><code>param.method</code> ‚Äî –æ—Ç—Ä–∞–∂–µ–Ω–∏–µ —Å–∞–º–æ–≥–æ –º–µ—Ç–æ–¥–∞.</li>
      <li><code>param.returnEarly = True</code> ‚Äî –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –º–µ—Ç–æ–¥–∞, –≤–µ—Ä–Ω—É–≤ <code>param.result</code> —Å—Ä–∞–∑—É.</li>
    </ul>

    <h2 id="process">–ü—Ä–æ—Ü–µ—Å—Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è (—à–∞–≥ –∑–∞ —à–∞–≥–æ–º)</h2>
    <ol>
      <li><strong>–ù–∞–π–¥–∏—Ç–µ –º–µ—Ç–æ–¥ –∏–ª–∏ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä</strong> —á–µ—Ä–µ–∑ Java reflection:
        <pre><code>from hook_utils import find_class
ActionBar = find_class("org.telegram.ui.ActionBar.ActionBar")
m = ActionBar.getDeclaredMethod("setTitle", find_class("java.lang.CharSequence"))
m.setAccessible(True)</code></pre>
      </li>
      <li><strong>–°–æ–∑–¥–∞–π—Ç–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫</strong>, –Ω–∞—Å–ª–µ–¥—É—è—Å—å –æ—Ç <code>MethodHook</code> –∏–ª–∏ <code>MethodReplacement</code>:
        <pre><code>class TitleLogger(MethodHook):
    def __init__(self, plugin): self.plugin = plugin
    def before_hooked_method(self, param):
        self.plugin.log(f"–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≥–æ–ª–æ–≤–∫–∞: {param.args[0]}")
        param.args[0] = "[Hooked] " + param.args[0]</code></pre>
      </li>
      <li><strong>–ü—Ä–∏–º–µ–Ω–∏—Ç–µ —Ö—É–∫</strong> –≤ <code>on_plugin_load</code>:
        <pre><code>handler = TitleLogger(self)
self.unhook = self.hook_method(m, handler, priority=10)</code></pre>
        <p>–•—É–∫ —É–¥–∞–ª–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –≤—ã–≥—Ä—É–∑–∫–µ, –∏–ª–∏ –≤—Ä—É—á–Ω—É—é —á–µ—Ä–µ–∑ <code>self.unhook_method(self.unhook)</code>.</p>
      </li>
    </ol>

    <h2 id="examples">–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–∏–º–µ—Ä—ã</h2>

    <h3>1. –ò–∑–º–µ–Ω–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –ø–µ—Ä–µ–¥ –≤—ã–∑–æ–≤–æ–º</h3>
    <pre><code>class ToastHook(MethodHook):
    def before_hooked_method(self, param):
        param.args[1] = "(Plugin) " + param.args[1]</code></pre>
    <p>–í on_plugin_load:</p>
    <pre><code>Toast = find_class("android.widget.Toast")
makeText = Toast.getDeclaredMethod("makeText", find_class("android.content.Context"), find_class("java.lang.CharSequence"), jint)
self.hook_method(makeText, ToastHook())</code></pre>

    <h3>2. –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –ø–æ—Å–ª–µ –≤—ã–∑–æ–≤–∞</h3>
    <pre><code>class BuildVarsHook(MethodHook):
    def after_hooked_method(self, param):
        param.result = False</code></pre>

    <h3>3. –ü–æ–ª–Ω–∞—è –∑–∞–º–µ–Ω–∞ –º–µ—Ç–æ–¥–∞</h3>
    <pre><code>class NoOpLogger(MethodReplacement):
    def replace_hooked_method(self, param):
        return None  # –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –∏—Å—Ö–æ–¥–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ</code></pre>
    <p>–ü—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ ‚Äî —á–µ—Ä–µ–∑ <code>self.hook_method</code>.</p>

    <p><strong>–ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ</strong> (—É–∫–∞–∑—ã–≤–∞—Ç—å –≤ .plugin-—Ñ–∞–π–ª–µ <em>–º–æ–∂–Ω–æ</em>, –Ω–æ –Ω–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ):</p>
    <pre><code>__id__ = "xposed_hook_plugin"
__mi_version__ = ">=1.0.0"
__icon__ = "üõ†Ô∏è"</code></pre>
    <p>–û—Å—Ç–∞–ª—å–Ω—ã–µ: <code>name</code>, <code>description</code>, <code>author</code>, <code>version</code> ‚Äî –∑–∞–¥–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ —Ä–µ–¥–∞–∫—Ç–æ—Ä (—É–¥–∞–ª–µ–Ω–∏–µ –≤–µ—Ä—Å–∏–∏ ‚Äî —á–µ—Ä–µ–∑ –º–µ–Ω–µ–¥–∂–µ—Ä).</p>
  </main>
</body>
</html>